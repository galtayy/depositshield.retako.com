(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4881],{5602:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/move-out/summary",function(){return o(5224)}])},5224:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return u}});var a=o(5893),s=o(645),r=o.n(s),l=o(7294),n=o(1163),i=o(9008),d=o.n(i),c=o(4354),m=o(1491),p=o(610);let x=()=>(0,a.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M15 19L8 12L15 5",stroke:"#2E3642",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})});function u(){let{user:e,loading:t}=(0,m.a)(),o=(0,n.useRouter)(),{propertyId:s}=o.query,[i,u]=(0,l.useState)(null),[h,f]=(0,l.useState)([]),[g,N]=(0,l.useState)({}),[b,y]=(0,l.useState)(!0),[v,j]=(0,l.useState)(!1),[w,I]=(0,l.useState)(""),[M,O]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(!t&&!e){o.push("/welcome");return}o.isReady&&s&&C(s)},[e,t,o,s,o.isReady]);let C=async e=>{try{y(!0),console.log("Fetching property data for ID: ".concat(e));try{let t=await p.E.properties.getById(e);u(t.data);let o=JSON.parse(localStorage.getItem("property_".concat(e,"_rooms"))||"[]");if(o.length>0){let e=o.map(e=>({id:e.roomId,name:e.roomName,type:e.roomType,photoCount:e.photoCount||0,moveOutPhotoCount:e.moveOutPhotoCount||0,roomQuality:e.roomQuality||null,roomIssueNotes:e.roomIssueNotes||[],moveOutNotes:e.moveOutNotes||[],moveOutDate:e.moveOutDate||null}));for(let t of(console.log("Rooms from localStorage:",e),f(e),e))t.id&&await D(t.id)}else try{let t=await p.E.properties.getRooms(e);if(t.data&&t.data.length>0){let e=t.data.map(e=>({id:e.roomId,name:e.roomName,type:e.roomType,photoCount:e.photoCount||0,moveOutPhotoCount:e.moveOutPhotoCount||0,roomQuality:e.roomQuality||null,roomIssueNotes:e.roomIssueNotes||[],moveOutNotes:e.moveOutNotes||[],moveOutDate:e.moveOutDate||null}));for(let t of(console.log("Rooms from API:",e),f(e),e))t.id&&await D(t.id)}}catch(e){console.error("Failed to load rooms from API:",e),console.error("Failed to load room data")}}catch(e){console.error("Failed to load property:",e),console.error("Property details could not be loaded")}}catch(e){console.error("Error loading data:",e),console.error("Could not load data. Please try again later.")}finally{y(!1)}},D=async e=>{if(s&&e)try{console.log("Fetching photos for room ".concat(e));let t=await p.E.photos.getByRoom(s,e);if(t.data&&t.data.length>0){console.log("Found ".concat(t.data.length," photos for room ").concat(e));let o=t.data.map(e=>({id:e.id,src:p.E.getPhotoUrl(e)||"",note:e.note||"",tags:e.tags||[],timestamp:e.created_at||null}));N(t=>({...t,[e]:o}))}}catch(t){console.error("Error fetching photos for room ".concat(e,":"),t)}},E=async()=>{try{j(!0);let t=(0,c.Z)(),a=[];Object.keys(g).forEach(e=>{let t=h.find(t=>t.id===e);t&&g[e].forEach(o=>{a.push({...o,roomId:e,roomName:t.name,roomType:t.type})})});let s={uuid:t,title:"Move-Out Report - ".concat(i.address),propertyId:i.id,property:{id:i.id,address:i.address,property_type:i.property_type,description:i.description},createdAt:new Date().toISOString(),tenant:{name:e.name,email:e.email,phone:e.phone||""},landlord:{name:i.landlord_name||"Property Owner",email:i.landlord_email||"",phone:i.landlord_phone||""},rooms:h.map(e=>({id:e.id,name:e.name,type:e.type,moveOutPhotoCount:e.moveOutPhotoCount||0,moveOutNotes:e.moveOutNotes||[],moveOutDate:e.moveOutDate||new Date().toISOString(),photos:g[e.id]||[]}))};try{let r=await p.E.reports.create({uuid:t,title:s.title,type:"move-out",description:"Move-out report for ".concat(i.address),property_id:i.id,address:i.address,tenant_name:e.name,tenant_email:e.email,tenant_phone:e.phone||"",landlord_name:i.landlord_name||"Property Owner",landlord_email:i.landlord_email||"",landlord_phone:i.landlord_phone||"",rooms:s.rooms.map(e=>({id:e.id,name:e.name,type:e.type,notes:e.moveOutNotes,photo_count:e.moveOutPhotoCount,move_out_date:e.moveOutDate}))});if(console.log("Report created:",r.data),a.length>0)for(let e of a)try{await p.E.photos.associateWithReport(e.id,r.data.id,{roomId:e.roomId,roomName:e.roomName})}catch(e){console.error("Error associating photo with report:",e)}let l=window.location.origin,n="".concat(l,"/reports/shared/").concat(t);I(n);try{await p.E.reports.sendNotification(r.data.id,{recipientEmail:i.landlord_email,recipientName:i.landlord_name||"Property Owner",subject:"New Move-Out Report Available",message:"A new move-out report has been created for your property at ".concat(i.address,". Click the link below to view the report."),reportId:r.data.id,reportUuid:t,reportUrl:n}),console.log("Report sent to landlord successfully!"),O(!0),localStorage.setItem("report_share_success","true"),localStorage.setItem("report_share_url",n),o.push({pathname:"/reports/share-success",query:{url:n}})}catch(e){console.error("Error sending notification email:",e),console.warn("Report created but email notification could not be sent"),O(!0),I(n)}}catch(e){console.error("Error creating report:",e),console.error("Failed to create report. Please try again.")}}catch(e){console.error("Error in send report process:",e),console.error("Failed to send report. Please try again later.")}finally{j(!1)}};return t||b?(0,a.jsx)("div",{className:"flex justify-center items-center h-screen bg-[#FBF5DA]",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#1C2C40]"})}):e?i?(0,a.jsxs)("div",{className:"flex flex-col items-center bg-[#FBF5DA] font-['Nunito'] min-h-screen",children:[(0,a.jsxs)(d(),{children:[(0,a.jsx)("title",{className:"jsx-abc2b0a84f1b3045",children:"Move-Out Report Summary"}),(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",className:"jsx-abc2b0a84f1b3045"}),(0,a.jsx)("meta",{name:"theme-color",content:"#FBF5DA",className:"jsx-abc2b0a84f1b3045"}),(0,a.jsx)("meta",{name:"apple-mobile-web-app-capable",content:"yes",className:"jsx-abc2b0a84f1b3045"}),(0,a.jsx)("meta",{name:"apple-mobile-web-app-status-bar-style",content:"default",className:"jsx-abc2b0a84f1b3045"}),(0,a.jsx)(r(),{id:"abc2b0a84f1b3045",children:'body{background-color:#FBF5DA;margin:0;padding:0;min-height:100vh;width:100%;font-family:"Nunito",sans-serif}.safe-area-top{padding-top:env(safe-area-inset-top,40px)}.safe-area-bottom{padding-bottom:env(safe-area-inset-bottom,20px)}'})]}),(0,a.jsxs)("div",{className:"w-full max-w-[390px] relative",children:[(0,a.jsx)("div",{className:"h-[40px] w-full safe-area-top"}),(0,a.jsx)("div",{className:"w-full h-[65px] border-b border-[#ECF0F5]",children:(0,a.jsxs)("div",{className:"flex flex-row justify-center items-center px-[10px] py-[20px] w-full h-[65px] relative",children:[(0,a.jsx)("button",{className:"absolute left-[20px] top-[50%] transform -translate-y-1/2 z-[2] flex items-center justify-center w-[40px] h-[40px]",onClick:()=>o.push("/move-out/rooms?propertyId=".concat(s)),"aria-label":"Go back",children:(0,a.jsx)(x,{})}),(0,a.jsx)("h1",{className:"font-semibold text-[18px] leading-[140%] text-center text-[#0B1420]",children:"Move-Out Report"})]})}),(0,a.jsxs)("div",{className:"w-full px-5 pb-32",children:[(0,a.jsxs)("div",{className:"w-full mx-auto mt-6",children:[(0,a.jsx)("h2",{className:"font-bold text-[16px] leading-[22px] text-[#0B1420] mb-1",children:"Review Your Move-Out Report"}),(0,a.jsx)("p",{className:"font-normal text-[14px] leading-[19px] text-[#515964] mb-6",children:"Here's a summary of the property and room conditions at move-out. Send this report to your landlord."})]}),(0,a.jsx)("div",{className:"w-full mx-auto mb-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-[16px] p-5 shadow-sm",children:[(0,a.jsx)("h3",{className:"font-bold text-[16px] leading-[22px] text-[#0B1420] mb-3",children:"Property Information"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{className:"font-medium text-[14px] leading-[19px] text-[#0B1420]",children:[(0,a.jsx)("span",{className:"text-[#6B7280]",children:"Address:"})," ",i.address||"Address not available"]}),(0,a.jsxs)("p",{className:"font-medium text-[14px] leading-[19px] text-[#0B1420]",children:[(0,a.jsx)("span",{className:"text-[#6B7280]",children:"Type:"})," ",i.property_type||"Not specified"]}),(0,a.jsxs)("p",{className:"font-medium text-[14px] leading-[19px] text-[#0B1420]",children:[(0,a.jsx)("span",{className:"text-[#6B7280]",children:"Move-out Date:"})," ",(e=>{try{let t=new Date(e);if(isNaN(t.getTime()))return"Date unavailable";return t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(e){return"Date unavailable"}})(new Date)]})]})]})}),(0,a.jsxs)("div",{className:"w-full mx-auto",children:[(0,a.jsx)("h3",{className:"font-bold text-[16px] leading-[22px] text-[#0B1420] mb-3",children:"Room Summaries"}),0===h.length?(0,a.jsx)("div",{className:"bg-white rounded-[16px] p-5 shadow-sm text-center",children:(0,a.jsx)("p",{className:"text-[#515964]",children:"No rooms have been documented yet."})}):(0,a.jsx)("div",{className:"space-y-4",children:h.map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-[16px] p-5 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,a.jsx)("h4",{className:"font-bold text-[15px] leading-[20px] text-[#0B1420]",children:e.name}),e.moveOutPhotoCount&&e.moveOutPhotoCount>0||e.moveOutNotes&&e.moveOutNotes.length>0?(0,a.jsx)("span",{className:"bg-[#4D935A] px-2 py-0.5 rounded-full text-[10px] font-semibold text-white",children:"Completed"}):(0,a.jsx)("span",{className:"bg-[#F3F4F6] px-2 py-0.5 rounded-full text-[10px] font-semibold text-[#6B7280]",children:"Not Complete"})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("h5",{className:"font-semibold text-[13px] leading-[18px] text-[#6B7280] mb-1",children:"Move-Out Notes"}),e.moveOutNotes&&e.moveOutNotes.length>0?(0,a.jsx)("ul",{className:"list-disc pl-5 space-y-1",children:e.moveOutNotes.map((e,t)=>(0,a.jsx)("li",{className:"font-medium text-[13px] leading-[18px] text-[#0B1420]",children:e},t))}):(0,a.jsx)("p",{className:"font-medium text-[13px] leading-[18px] text-[#6B7280]",children:"No notes provided"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"font-semibold text-[13px] leading-[18px] text-[#6B7280] mb-1",children:"Photos"}),g[e.id]&&g[e.id].length>0?(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[g[e.id].slice(0,4).map((t,o)=>(0,a.jsx)("div",{className:"w-[60px] h-[60px] rounded-[8px] bg-gray-200 overflow-hidden",children:(0,a.jsx)("img",{src:t.src,alt:"".concat(e.name," photo ").concat(o+1),className:"w-full h-full object-cover",onError:t=>{console.error("Error loading thumbnail ".concat(o," for room ").concat(e.id)),t.target.onerror=null,t.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIGZpbGw9IiNFRkVGRUYiLz48cGF0aCBkPSJNOSAxNkgxNVYxN0g5VjE2WiIgZmlsbD0iIzk5OSIvPjxwYXRoIGQ9Ik0xMiA3QzEwLjM0IDcgOSA4LjM0IDkgMTBDOSAxMS42NiAxMC4zNCAxMyAxMiAxM0MxMy42NiAxMyAxNSAxMS42NiAxNSAxMEMxNSA4LjM0IDEzLjY2IDcgMTIgN1pNMTIgMTJDMTAuOSAxMiAxMCAxMS4xIDEwIDEwQzEwIDguOSAxMC45IDggMTIgOEMxMy4xIDggMTQgOC45IDE0IDEwQzE0IDExLjEgMTMuMSAxMiAxMiAxMloiIGZpbGw9IiM5OTkiLz48L3N2Zz4="}})},o)),g[e.id].length>4&&(0,a.jsxs)("div",{className:"w-[60px] h-[60px] rounded-[8px] bg-[#1C2C40] flex items-center justify-center text-white font-bold text-sm",children:["+",g[e.id].length-4]})]}):(0,a.jsx)("p",{className:"font-medium text-[13px] leading-[18px] text-[#6B7280]",children:"No photos available"})]})]},e.id))})]})]}),(0,a.jsx)("div",{className:"fixed left-0 right-0 bottom-0 w-full px-5 py-4 bg-[#FBF5DA] safe-area-bottom border-t border-[#E5E7EB]",children:(0,a.jsx)("div",{className:"max-w-[390px] mx-auto",children:(0,a.jsx)("button",{disabled:v,onClick:E,className:"w-full h-[56px] flex justify-center items-center rounded-[16px] shadow-sm font-bold text-[16px] leading-[22px] text-center\n                ".concat(v?"bg-[#C6CCD5] text-[#6B7280] cursor-not-allowed":"bg-[#1C2C40] text-[#D1E7E2] cursor-pointer"),children:v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-[#6B7280]",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Sending Report..."]}):"Send Report to Landlord"})})})]})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-screen bg-[#FBF5DA] px-4",children:[(0,a.jsx)("p",{className:"text-[#515964] text-center",children:"Property details could not be loaded. Please try again."}),(0,a.jsx)("button",{onClick:()=>o.push("/move-out"),className:"mt-4 px-6 py-3 bg-[#1C2C40] rounded-[16px] text-[#D1E7E2] font-bold text-[16px]",children:"Go Back"})]}):null}}},function(e){e.O(0,[6565,2888,9774,179],function(){return e(e.s=5602)}),_N_E=e.O()}]);