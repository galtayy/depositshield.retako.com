(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9119],{478:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/photos/[id]",function(){return s(658)}])},658:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var o=s(5893),r=s(7294),a=s(1163),n=s(1664),l=s.n(n),i=s(2920),d=s(6153),c=s(610),h=s(1491);function m(){var e;let{user:t,loading:s}=(0,h.a)(),[n,m]=(0,r.useState)(null),[u,x]=(0,r.useState)(null),[g,p]=(0,r.useState)(""),[f,b]=(0,r.useState)(""),[v,y]=(0,r.useState)([]),[w,j]=(0,r.useState)(!0),[N,k]=(0,r.useState)(!1),A=(0,a.useRouter)(),{id:C}=A.query,P=(0,r.useRef)(null),[E,_]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!s&&!t){A.push("/login");return}C&&T()},[C,t,s,A]);let T=async()=>{try{console.log("Fetching photo details:",C);let e=await c.E.photos.getById(C);console.log("Photo details response:",e.data);let t=e.data;if(m(t),p(t.note||""),y(t.tags||[]),t.report_id){let e=await c.E.reports.getById(t.report_id);x(e.data)}}catch(t){console.error("Photo fetch error:",t);let e="An error occurred while loading photo information.";t.response&&(console.error("API response error:",t.response.data),e=t.response.data.message||e),i.Am.error(e)}finally{j(!1)}},I=async()=>{try{k(!0),console.log("Updating note:",g);let e=await c.E.photos.updateNote(C,g);console.log("Note update response:",e.data),i.Am.success("Note updated successfully.")}catch(t){console.error("Note update error:",t);let e="An error occurred while updating the note.";t.response&&(console.error("API yanıt hatası:",t.response.data),e=t.response.data.message||e),i.Am.error(e)}finally{k(!1)}},L=async()=>{if(f.trim())try{k(!0),console.log("Adding tag:",f);let e=await c.E.photos.addTag(C,f);console.log("Add tag response:",e.data),y(e.data.photo.tags||[]),b(""),_(null),i.Am.success("Tag added successfully.")}catch(t){console.error("Tag add error:",t);let e="An error occurred while adding the tag.";t.response&&(console.error("API yanıt hatası:",t.response.data),e=t.response.data.message||e),i.Am.error(e)}finally{k(!1)}},B=async e=>{try{k(!0),console.log("Removing tag:",e);let t=await c.E.photos.removeTag(C,e);console.log("Remove tag response:",t.data),y(t.data.photo.tags||[]),i.Am.success("Tag removed successfully.")}catch(t){console.error("Tag remove error:",t);let e="An error occurred while removing the tag.";t.response&&(console.error("API yanıt hatası:",t.response.data),e=t.response.data.message||e),i.Am.error(e)}finally{k(!1)}},S=async()=>{if(confirm("Are you sure you want to delete this photo? This action cannot be undone."))try{console.log("Deleting photo:",C),await c.E.photos.delete(C),console.log("Photo deleted"),i.Am.success("Photo deleted successfully."),u?A.push("/reports/".concat(u.id)):A.push("/reports")}catch(t){console.error("Photo delete error:",t);let e="An error occurred while deleting the photo.";t.response&&(console.error("API yanıt hatası:",t.response.data),e=t.response.data.message||e),i.Am.error(e)}};return w||s?(0,o.jsx)(d.Z,{children:(0,o.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl animate-fadeIn",children:[(0,o.jsx)("h1",{className:"text-2xl font-bold text-indigo-700 mb-6",children:"Photo Details"}),(0,o.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})})]})}):n?(0,o.jsx)(d.Z,{children:(0,o.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl animate-fadeIn",children:[(0,o.jsxs)("div",{className:"flex items-center mb-6",children:[(0,o.jsx)("button",{onClick:()=>A.back(),className:"mr-4 text-gray-600 hover:text-gray-900","aria-label":"Back",children:(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,o.jsx)("h1",{className:"text-2xl font-bold text-indigo-700",children:"Photo Details"})]}),(0,o.jsxs)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 mb-6",children:[u&&(0,o.jsx)("div",{className:"bg-indigo-50 p-4",children:(0,o.jsxs)("p",{className:"text-sm text-gray-700",children:["Report: ",(0,o.jsx)(l(),{href:"/reports/".concat(u.id),className:"text-indigo-700 hover:underline font-medium",children:u.title})]})}),(0,o.jsxs)("div",{className:"p-6",children:[(0,o.jsxs)("div",{className:"relative mb-6",children:[(0,o.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Click on the photo to add tags"}),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("img",{ref:P,src:(null===(e=n.url)||void 0===e?void 0:e.startsWith("http"))?n.url:"https://apidepositshield.retako.com".concat(n.url),alt:n.note||"Report photo",className:"w-full rounded-lg cursor-crosshair",onClick:e=>{if(!P.current)return;let t=P.current.getBoundingClientRect(),s=e.clientX-t.left,o=e.clientY-t.top;_({x:s/t.width*100,y:o/t.height*100}),setTimeout(()=>{let e=document.getElementById("tag-input");e&&e.focus()},100)},onError:e=>{console.error("Image loading error"),n.url&&!n.url.startsWith("http")?e.target.src="https://apidepositshield.retako.com/uploads/".concat(n.url.split("/").pop()):e.target.src="/images/placeholder-image.svg"}}),v.map((e,t)=>(0,o.jsxs)("span",{className:"absolute bg-indigo-600 text-white text-xs px-2 py-1 rounded transform -translate-x-1/2 -translate-y-1/2 shadow-md",style:{left:"".concat(t%5*20+10,"%"),top:"".concat(20*Math.floor(t/5)+10,"%")},children:[e,(0,o.jsx)("button",{onClick:()=>B(e),className:"ml-1 text-white hover:text-gray-200",children:"\xd7"})]},t)),E&&(0,o.jsx)("div",{className:"absolute bg-white shadow-lg rounded-md p-2 z-10 transform -translate-x-1/2",style:{left:"".concat(E.x,"%"),top:"".concat(E.y+7,"%")},children:(0,o.jsxs)("div",{className:"flex",children:[(0,o.jsx)("input",{id:"tag-input",type:"text",value:f,onChange:e=>b(e.target.value),onKeyPress:e=>{"Enter"===e.key&&L()},placeholder:"Tag",className:"text-sm border border-gray-300 rounded-l-md px-2 py-1 focus:outline-none focus:ring-1 focus:ring-indigo-500"}),(0,o.jsx)("button",{onClick:L,disabled:N,className:"bg-indigo-600 text-white text-sm rounded-r-md px-2 py-1 hover:bg-indigo-500 transition-all duration-300",children:"Add"})]})})]})]}),(0,o.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"note",className:"block text-sm font-medium text-gray-700 mb-2",children:"Note"}),(0,o.jsxs)("div",{className:"flex",children:[(0,o.jsx)("textarea",{id:"note",value:g,onChange:e=>p(e.target.value),rows:3,className:"flex-grow input focus:border-indigo-500 transition-all duration-300 mr-2",placeholder:"Add a note about this photo"}),(0,o.jsx)("button",{onClick:I,disabled:N,className:"btn btn-primary hover:bg-indigo-500 transition-all duration-300 h-10 self-start",children:"Save"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Tags"}),(0,o.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,o.jsxs)("div",{className:"flex flex-wrap gap-2",children:[v.map((e,t)=>(0,o.jsxs)("span",{className:"bg-indigo-50 text-indigo-700 text-sm px-2 py-1 rounded-full inline-flex items-center",children:[e,(0,o.jsx)("button",{onClick:()=>B(e),className:"ml-1 text-indigo-400 hover:text-indigo-600 transition-colors",children:"\xd7"})]},t)),0===v.length&&(0,o.jsx)("p",{className:"text-sm text-gray-500",children:"No tags added yet"})]})})]})]}),(0,o.jsxs)("div",{className:"flex justify-between items-center mt-6 pt-4 border-t border-gray-100",children:[(0,o.jsx)("div",{className:"text-xs text-gray-500",children:new Date(n.timestamp).toLocaleString("en-US")}),(0,o.jsxs)("button",{onClick:S,className:"btn bg-red-50 text-red-600 border border-red-200 hover:bg-red-100 transition-all duration-300 flex items-center",children:[(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete Photo"]})]})]})]})]})}):(0,o.jsx)(d.Z,{children:(0,o.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl animate-fadeIn",children:[(0,o.jsxs)("div",{className:"flex items-center mb-6",children:[(0,o.jsx)("button",{onClick:()=>A.back(),className:"mr-4 text-gray-600 hover:text-gray-900","aria-label":"Back",children:(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,o.jsx)("h1",{className:"text-2xl font-bold text-indigo-700",children:"Photo Not Found"})]}),(0,o.jsx)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 p-6 text-center",children:(0,o.jsxs)("div",{className:"py-8",children:[(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto text-gray-300 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"Photo Not Found"}),(0,o.jsx)("p",{className:"text-gray-600 mb-6",children:"The requested photo was not found or you don't have access to it."}),(0,o.jsx)("button",{onClick:()=>A.back(),className:"btn btn-primary hover:bg-indigo-500 transition-all duration-300",children:"Go Back"})]})})]})})}}},function(e){e.O(0,[1664,6153,2888,9774,179],function(){return e(e.s=478)}),_N_E=e.O()}]);