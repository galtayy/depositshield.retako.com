(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1567],{1776:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reports/shared/[uuid]",function(){return o(9773)}])},9773:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return p}});var s=o(5893),a=o(7294),l=o(1163),n=o(9008),r=o.n(n),c=o(7066);let i="localhost"!==window.location.hostname?"https://api.depositshield.retako.com":"http://localhost:5050",d=()=>{console.log("Using API_URL:",i),console.log("Window hostname:",window.location.hostname)};function p(){var e;let t=(0,l.useRouter)(),{uuid:o}=t.query,[n,p]=(0,a.useState)(null),[h,x]=(0,a.useState)(!0),[m,u]=(0,a.useState)(null),[f,g]=(0,a.useState)([]),[j,v]=(0,a.useState)({}),[N,b]=(0,a.useState)(!1),[w,y]=(0,a.useState)(null);(0,a.useEffect)(()=>{t.isReady&&o&&(d(),console.log("[Report Viewer] Fetching report with UUID: ".concat(o)),C())},[t.isReady,o]);let C=async()=>{try{x(!0),console.log("Fetching shared report with UUID:",o);try{let e=(await c.default.get("".concat(i,"/api/reports/uuid/").concat(o),{headers:{Accept:"application/json"}})).data;if(console.log("Report data:",e),e&&e.baseUrl&&console.log("Report base URL:",e.baseUrl),e){let t=e.rooms||[];console.log("Found ".concat(t.length," rooms from API response")),t.length>0&&t.forEach(e=>{console.log("Room ".concat(e.name,": ").concat(e.photos?e.photos.length:0," photos")),e.photos&&e.photos.length>0&&e.photos.forEach((t,o)=>{console.log("Room ".concat(e.name," Photo ").concat(o+1,":"),t)})}),e.photos&&e.photos.length>0&&(console.log("Found ".concat(e.photos.length," photos at report level, distributing to rooms")),e.photos.forEach(e=>{if(e.room_id){let o=t.find(t=>t.id===e.room_id);o&&(o.photos||(o.photos=[]),o.photos.push(e),console.log("Added photo ".concat(e.id," to room ").concat(o.name)))}})),p(e),u(e.property),g(t);let o={};t.forEach(e=>{o[e.id]="photos"}),v(o),x(!1);return}}catch(e){console.error("Failed to fetch report:",e)}console.warn("API error or data not available for this report");let e={id:o,title:"Report Not Available",type:"error",address:"Report data could not be loaded",description:"Unable to load move-out report details",created_at:new Date().toISOString(),property:{id:o,address:"Property information not available",property_type:"",description:""},tenant:{name:"",email:"",phone:""},landlord:{name:"",email:"",phone:""},rooms:[]};console.error("Report data could not be loaded. Please try again or contact support."),p(e),u(e.property),g(e.rooms);let t={};e.rooms.forEach(e=>{t[e.id]="photos"}),v(t),x(!1)}catch(e){console.error("Error fetching report:",e),x(!1)}},_=e=>{if(!e)return"https://via.placeholder.com/300x200?text=No+Photo";console.log("Processing photo:",e);try{if(e.url){if(e.url.startsWith("/uploads"))return"".concat(i).concat(e.url);return e.url}if(e.file_path)return console.log("Constructing URL from file_path: ".concat(e.file_path)),"".concat(i,"/uploads/").concat(e.file_path);if(e.id&&"number"==typeof e.id)return console.log("Constructing URL from photo ID: ".concat(e.id)),"".concat(i,"/api/photos/").concat(e.id,"/public");if(e.path){if(e.path.startsWith("http"))return e.path;return"".concat(i,"/").concat(e.path.replace(/^\//,""))}if(e.filename)return"".concat(i,"/uploads/").concat(e.filename);if("string"==typeof e){if(e.startsWith("http"))return e;return"".concat(i,"/").concat(e.replace(/^\//,""))}}catch(e){console.error("Error constructing photo URL:",e)}return console.log("Falling back to placeholder for photo:",e),"https://via.placeholder.com/300x200?text=Error+Loading"},k=(e,t)=>{v(o=>({...o,[e]:t}))};return h?(0,s.jsx)("div",{className:"flex justify-center items-center min-h-screen bg-[#FBF5DA]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#1C2C40]"})}):!n||n.error?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-[#FBF5DA] px-4",children:[(0,s.jsx)("svg",{className:"w-16 h-16 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,s.jsx)("h1",{className:"text-xl font-bold text-[#1C2C40] mb-4",children:"Report Not Available"}),(0,s.jsx)("p",{className:"text-[#515964] text-center mb-6",children:n&&n.error?n.description:"The report you are looking for could not be found. The link may be invalid or the report has been deleted."}),(0,s.jsx)("button",{onClick:()=>window.history.back(),className:"px-4 py-2 bg-[#3B7145] text-white rounded-md hover:bg-[#2A5A32] transition-colors",children:"Go Back"})]}):(0,s.jsxs)("div",{className:"relative w-full min-h-screen max-w-[390px] mx-auto bg-[#FBF5DA] font-['Nunito']",children:[w&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80 p-4",onClick:()=>y(null),children:(0,s.jsxs)("div",{className:"relative max-w-full max-h-full",children:[(0,s.jsx)("img",{src:w.url,alt:w.alt,className:"max-w-full max-h-[90vh] object-contain"}),(0,s.jsx)("button",{className:"absolute top-2 right-2 w-8 h-8 flex items-center justify-center bg-white bg-opacity-70 rounded-full",onClick:e=>{e.stopPropagation(),y(null)},children:(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M12 4L4 12",stroke:"#0B1420",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M4 4L12 12",stroke:"#0B1420",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})}),(0,s.jsxs)(r(),{children:[(0,s.jsx)("title",{children:"Move-Out Report - DepositShield"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"}),(0,s.jsx)("meta",{name:"theme-color",content:"#FBF5DA"}),(0,s.jsx)("meta",{name:"apple-mobile-web-app-capable",content:"yes"})]}),(0,s.jsx)("div",{className:"w-full h-[40px]"}),(0,s.jsxs)("div",{className:"flex flex-col items-start px-5 gap-1 mt-[32px]",children:[(0,s.jsxs)("div",{className:"flex flex-row items-center justify-between w-full",children:[(0,s.jsx)("h1",{className:"font-bold text-[20px] leading-[27px] text-[#0B1420]",children:"Walkthrough Details"}),(0,s.jsx)("button",{className:"p-1",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M16.75 22.16c-.41 0-.75-.34-.75-.75v-2.04c0-.36.06-.7.17-1.01l.07-.2c.05-.12.1-.25.15-.37.43-1.01 1.32-1.99 3.05-3.35l.3-.23c.51-.4.81-1.01.81-1.65v-2.6c0-.89-.26-1.75-.76-2.48C19.21 6.64 18.21 6 17.09 6H7c-1.06 0-2.02.57-2.55 1.48-.52.91-.52 2.03 0 2.95.53.92 1.49 1.48 2.55 1.48.41 0 .75.34.75.75s-.34.75-.75.75c-1.47 0-2.81-.79-3.56-2.06-.76-1.29-.76-2.86 0-4.15C4.19 5.89 5.53 5.1 7 5.1h10.09c1.49 0 2.86.86 3.55 2.19.63.93.97 2.03.97 3.19v2.6c0 1.11-.54 2.17-1.44 2.83l-.3.24c-1.56 1.23-2.33 2.04-2.66 2.79-.03.07-.07.15-.1.22l-.06.18c-.05.15-.08.31-.08.47v2.04c.04.42-.3.76-.72.76z",fill:"#292D32"}),(0,s.jsx)("path",{d:"M12 18.75c-.42 0-.75-.33-.75-.75v-4.25c0-.41.33-.75.75-.75s.75.34.75.75V18c0 .42-.33.75-.75.75zM12 8.25c-.41 0-.75-.34-.75-.75s.34-.75.75-.75.75.33.75.75-.34.75-.75.75z",fill:"#292D32"})]})})]}),(0,s.jsx)("p",{className:"font-normal text-[14px] leading-[19px] text-[#515964]",children:"Move-out details uploaded by the tenant"})]}),(0,s.jsx)("div",{className:"px-5 mt-[24px]",children:(0,s.jsxs)("div",{className:"flex flex-col bg-white border border-[#D1E7D5] rounded-[16px] overflow-hidden transition-all duration-300 ".concat("mb-0"),onClick:()=>b(!N),children:[(0,s.jsxs)("div",{className:"flex flex-row items-center p-[18px] gap-2 cursor-pointer",children:[(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M17.8334 6.29166C17.6084 6.29166 17.3917 6.19999 17.2334 6.04166C17.0667 5.87499 16.9834 5.65833 16.9834 5.42499V3.56666L12.65 7.90833C12.3334 8.22499 11.8167 8.22499 11.5 7.90833C11.1834 7.59166 11.1834 7.07499 11.5 6.75833L15.825 2.43333H13.9667C13.4834 2.43333 13.0834 2.03333 13.0834 1.54999C13.0834 1.06666 13.4834 0.666656 13.9667 0.666656H17.8334C18.3167 0.666656 18.7167 1.06666 18.7167 1.54999V5.41666C18.7167 5.89999 18.3167 6.29999 17.8334 6.29999V6.29166Z",fill:"#515964"}),(0,s.jsx)("path",{d:"M7.4583 19.3333H3.5583C1.59997 19.3333 0.833301 18.5667 0.833301 16.6083V3.3917C0.833301 1.43336 1.59997 0.666693 3.5583 0.666693H7.4583C7.94163 0.666693 8.3333 1.06669 8.3333 1.55003C8.3333 2.03336 7.94163 2.43336 7.4583 2.43336H3.5583C2.59163 2.43336 2.59163 2.44169 2.59163 3.40003V16.6167C2.59163 17.5667 2.59997 17.575 3.5583 17.575H7.4583C7.94163 17.575 8.3333 17.975 8.3333 18.4583C8.3333 18.9417 7.94163 19.3417 7.4583 19.3417V19.3333Z",fill:"#515964"}),(0,s.jsx)("path",{d:"M11.6583 19.3333H8.33329C7.84996 19.3333 7.44995 18.9333 7.44995 18.45C7.44995 17.9667 7.84996 17.5666 8.33329 17.5666H11.6583C12.6166 17.5666 12.6166 17.5583 12.6166 16.6V3.3917C12.6166 2.44169 12.6166 2.43336 11.6583 2.43336H8.33329C7.84996 2.43336 7.44995 2.03336 7.44995 1.55003C7.44995 1.06669 7.84996 0.666693 8.33329 0.666693H11.6583C13.6166 0.666693 14.3833 1.43336 14.3833 3.3917V16.6083C14.3833 18.5667 13.6166 19.3333 11.6583 19.3333Z",fill:"#515964"})]}),(0,s.jsx)("div",{className:"flex-grow",children:(0,s.jsx)("span",{className:"font-bold text-[14px] leading-[19px] text-[#515964]",children:"Home & Lease Details"})}),(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"transition-transform duration-300 ".concat(N?"rotate-180":""),children:(0,s.jsx)("path",{d:"M16.6 7.45834L11.1667 12.8917C10.525 13.5333 9.47503 13.5333 8.83336 12.8917L3.40002 7.45834",stroke:"#515964",strokeWidth:"1.5",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"})})]}),(0,s.jsx)("div",{className:"transition-all duration-300 overflow-hidden ".concat(N?"max-h-[500px] opacity-100":"max-h-0 opacity-0"),children:(0,s.jsx)("div",{className:"px-4 pb-4 pt-1 border-t border-[#F3F4F6]",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3 text-[14px]",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[#515964] text-[12px]",children:"Tenant:"}),(0,s.jsx)("p",{className:"font-medium text-[#0B1420] text-[14px]",children:n.tenant_name||(null===(e=n.tenant)||void 0===e?void 0:e.name)||n.creator_name||"Tenant Name"})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[#515964] text-[12px]",children:"Property Address:"}),(0,s.jsx)("p",{className:"font-medium text-[#0B1420] text-[14px]",children:(null==m?void 0:m.description)||(null==m?void 0:m.address)||"Property Address"})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[#515964] text-[12px]",children:"Lease Duration:"}),(0,s.jsx)("p",{className:"font-medium text-[#0B1420] text-[14px]",children:n.lease_duration?"".concat(n.lease_duration," ").concat(n.lease_duration_type||"months"):"12 months"})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[#515964] text-[12px]",children:"Move-out Date:"}),(0,s.jsx)("p",{className:"font-medium text-[#0B1420] text-[14px]",children:n.contract_end_date?new Date(n.contract_end_date).toLocaleDateString("en-US",{day:"numeric",month:"long",year:"numeric"}):"Not specified"})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[#515964] text-[12px]",children:"Deposit Amount:"}),(0,s.jsx)("p",{className:"font-medium text-[#0B1420] text-[14px]",children:n.deposit_amount?"$".concat(n.deposit_amount):"Not specified"})]})]})})})]})}),(0,s.jsx)("h2",{className:"font-bold text-[20px] leading-[27px] text-[#0B1420] px-5 mt-[24px]",children:"Rooms"}),(0,s.jsx)("div",{className:"mt-4 pb-20",children:f.map((e,t)=>(0,s.jsxs)("div",{className:"mb-12",children:[(0,s.jsxs)("h3",{className:"font-bold text-[16px] leading-[22px] text-[#0B1420] px-5 mb-4",children:[e.name," ",e.type&&"(".concat(e.type.charAt(0).toUpperCase()+e.type.slice(1),")")]}),(0,s.jsxs)("div",{className:"flex flex-row items-start px-5 gap-4 mb-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1 cursor-pointer ".concat("photos"===j[e.id]?"text-[#3B7145]":"text-[#515964]"),onClick:()=>k(e.id,"photos"),children:[(0,s.jsxs)("span",{className:"font-semibold text-[16px] leading-[22px]",children:["Photos (",e.photos?e.photos.length:e.photo_count||0,")"]}),"photos"===j[e.id]&&(0,s.jsx)("div",{className:"h-[1.5px] bg-[#3B7145]"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1 cursor-pointer ".concat("notes"===j[e.id]?"text-[#3B7145]":"text-[#515964]"),onClick:()=>k(e.id,"notes"),children:[(0,s.jsxs)("span",{className:"font-semibold text-[16px] leading-[22px]",children:["Notes (",e.moveOutNotes?e.moveOutNotes.length:e.notes?e.notes.length:0,")"]}),"notes"===j[e.id]&&(0,s.jsx)("div",{className:"h-[1.5px] bg-[#3B7145]"})]})]}),"photos"===j[e.id]&&(0,s.jsx)("div",{className:"px-5",children:(0,s.jsx)("div",{className:"grid grid-cols-3 gap-4",children:e.photos&&e.photos.length>0?e.photos.slice(0,6).map((t,o)=>{let a;return a=t.absolute_url?t.absolute_url:t.url&&t.url.startsWith("/uploads")&&n.baseUrl?"".concat(n.baseUrl).concat(t.url):t.file_path?"".concat(i,"/uploads/").concat(t.file_path):_(t),console.log("Displaying photo ".concat(o+1," for room ").concat(e.name,":"),a),console.log("Photo object:",t),(0,s.jsx)("div",{className:"aspect-square bg-gray-200 rounded-[16px] overflow-hidden cursor-pointer",onClick:()=>y({url:a,alt:"".concat(e.name," photo ").concat(o+1)}),children:(0,s.jsx)("img",{src:a,alt:"".concat(e.name," photo ").concat(o+1),className:"w-full h-full object-cover",onError:e=>{console.error("Error loading image at ".concat(a)),e.target.src="https://via.placeholder.com/150?text=Photo"}})},t.id||o)}):(0,s.jsx)("div",{className:"col-span-3 py-4 text-center text-gray-500",children:"No photos available for this room"})})}),"notes"===j[e.id]&&(0,s.jsx)("div",{className:"px-5",children:e.moveOutNotes&&e.moveOutNotes.length>0?(0,s.jsx)("ul",{className:"list-disc pl-5 space-y-2",children:e.moveOutNotes.map((e,t)=>(0,s.jsx)("li",{className:"font-medium text-[14px] leading-[19px] text-[#0B1420]",children:e},t))}):(0,s.jsx)("p",{className:"font-medium text-[14px] leading-[19px] text-[#6B7280]",children:"No notes available for this room."})})]},e.id))})]})}}},function(e){e.O(0,[2888,9774,179],function(){return e(e.s=1776)}),_N_E=e.O()}]);